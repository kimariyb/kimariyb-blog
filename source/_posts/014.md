---
title: 使用 KimariDraw 处理 Multiwfn 生成的光谱数据
date: 2023-07-16 20:45:42
tags:
    - Gaussian
    - Multiwfn
    - KimariDraw
    - 量子化学
    - Spectrum
categories: 
    - Computer Chemistry
description: 本文将介绍如何使用笔者自己开发的 KimariDraw 结合 Multiwfn 绘制 NMR、IR 等化学光谱图。
---

<p><strong style="color:red; font-size:16pt;">KimariDraw 目前已经更新至 2.5.1 版本，本文中所有介绍 KimariDraw 的内容都已过时，全是废话！</strong></p>

<p><strong style="color:red; font-size:16pt;">本文介绍的 KimariDraw 为 2.4.0 版本，如果版本更新可能和实际版本的操作不一致</strong></p>

## 前言

在笔者的 [《Gaussian + Multiwfn 绘制 NMR 谱》](https://ikuns.icu/013)中介绍了如何利用量子化学计算程序 Gaussian 和 Sob 老师的 Multiwfn 绘制 NMR 谱。尽管 Multiwfn 是一个功能非常强大的波函数分析程序，但是如果直接使用 Multiwfn 生成的各种光谱图，则很难让人眼前一亮。为此，笔者开发了一个用来处理 Multiwfn 产生的光谱数据，进而绘制更加美观的光谱图的 Python 程序，名为 [KimariDraw](https://github.com/kimariyb/kimariDraw)。尽管 KimariDraw 远没有 Multiwfn 功能强大，但是能很好的弥补 Multiwfn 绘图不够美观的缺点。虽然可以使用类似 Origin 的科研绘图软件，但是 KimariDraw 更为高效快速，如果你想应急、偷懒、省时、省事，那么 KimariDraw 是一个很好的选择。

## 关于 KimariDraw

KimariDraw 是一款开源的跨平台 Python 脚本，旨在绘制各种光谱图形，特别适用于处理著名的波函数分析程序 Multiwfn 生成的光谱数据。它能够将 Multiwfn 生成的数据以美观、清晰的方式重新绘制成单曲线单子图、多曲线单子图、单曲线多子图以及多曲线多子图。

<p><strong style="color:red; font-size:14pt;">KimariDraw 具有以下特点：</strong></p>

- **支持多种光谱类型**：KimariDraw 支持使用 Multiwfn 绘制 NMR、IR 等光谱导出的数据，即 Multiwfn 生成的文本文件。
- **支持多子图绘制**：KimariDraw 不仅支持一单子图的绘制，同时也支持多子图的绘制。
- **支持多种文件格式**：KimariDraw 支持将图片导出为多种文件格式，如 PNG、JPG、PDF、SVG 等。
- **易于安装和配置**：KimariDraw 的安装和配置十分简单，您只需要按照项目 README 文件中的说明进行操作即可。
- **自定义功能强大**：KimariDraw 可以根据需要自定义曲线的颜色、图例以及格式，可以达到科研论文要求。

KimariDraw 目前已经在 Github 上开源，具体的安装和使用说明可以前往 [KimariDraw Github 主页](https://github.com/kimariyb/kimariDraw)浏览。


## 安装

**推荐！** 笔者推荐推荐使用 anaconda 虚拟环境进行安装，方便对包进行管理，同时也不会影响其他项目的环境。如果没有安装 Python，可以不用安装 Python，直接前往 anaconda 官网下载 anaconda 最新版本。安装并配置好以后，使用 anaconda 新建一个环境。

```shell
conda create -n kimaridraw python=3.8.13
```

激活名为 kimaridraw 的 conda 环境：

```shell
conda activate kimaridraw
```

下载 KimariDraw 源代码：

```shell
git clone https://github.com/kimariyb/kimariDraw.git
```

进入 KimariDraw 目录并安装依赖：

```shell
cd kimariDraw 
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

这将自动安装 KimariDraw 所需的 pandas、matplotlib 和 proplot 等依赖项。同时，由于激活的 conda 环境，因此 pip 安装的包只会在 kimaridraw 环境下使用，如果不激活就不会被使用。这样就很好的避免了不同任务依赖的环境不同，所导致的版本冲突。

## 配置文件

在绘制光谱前，必须创建一个 `settings.toml` 作为绘制光谱的配置文件。KimariDraw 启动时将默认读取当前路径下的 `settings.toml` 作为配置文件。同时，KimariDraw 也支持选择其他名字的 toml 文件作为配置文件。一个简单的 toml 配置文件如下所示：

```toml
# 光谱绘制的类型，可选 1. 单子图；2. 多子图。
# 如果需要绘制多子图，则需要先修改 PlotType，再将包含多子图的数据的 txt 文件文件名写在一个名为 multiple.txt 的文件中
PlotType = 2
# X 轴坐标的最小、最大值以及间距，例如 0, 4000, 500
xLimit = [0, 4000, 500]
# Y 轴坐标的最小、最大值以及间距，例如 0, 3000, 1000
yLimit = [0, 3000, 1000]
# 配图的标题，可以为空
Title = ""
# 设置 x 轴标签
xLabel = "Frequency (in cm^-1)"
# 设置 y 轴标签
yLabel = "Absorption (in L/mol/cm)"
# 设置全局的字体，一般为 Arial
FontFamily = "Arial"
# 设置图片的大小，也就是设置图片的长和宽。就算开启绘制多子图模式，也代表的是总的大小，不是子图的大小。
# 绘制多子图时，可以先想好每一个子图的大小，然后分别乘上行数和列数。必须为相同数据类型！
FigureSize = [4.5, 4.8]
# 曲线的颜色，可以为一个列表，优先从第一个开始选择。如果为空，则为默认的 color cycle。
# 如果开启了多子图，则每一个颜色就对应一个子图曲线的颜色。
Colors = ["black", "red", "orange", "blue"]
# 曲线的样式，可以为一个列表，优先从第一个开始选择
# 如果开启了多子图，则每一个格式就对应一个子图的格式
LineStyle = ["-", "-", "-", "-"]
# 是否显示表达式为 Y = 0 的直线，可选 0. 关闭；1. 开启
# 可以在绘制 ECD、VCD 谱时开启
ZeroLine = 0
# 选择是否显示子图的序号，只能在左上角。可选 0. 关闭；1. 开启
# 需要开启多子图才能配置
Serial = 1
# 是否显示图例，可选 0. 关闭；1. 开启
# 通常是绘制单子图的多曲线图时开启，多子图也可以开启。单开启时显示在图像的右上角。
Legend = 1
# 图例的文本，需要和 Colors 和 LineStyle 列表中元素的数量一样
LegendText = ["Acetaldehyde", "Methyl acetate", "Acetone", "N-Methylacetamide"]
# 多子图的排版，例如，[2, 2] 为 2 行 2 列的排列。推荐奇数使用 [n, 1]，偶数使用 [n/2, n/2]
# 仅开启多子图才能生效
SupType = [4, 1]
```

## 绘制光谱

在量子化学计算完成后，使用波函数分析程序 [Multiwfn](http://sobereva.com/multiwfn/) 处理 Gaussian 的输出文件，就可以得到各类的光谱数据。至于如何使用 Multiwfn 绘制 IR、Raman 等光谱，可以参考 Multiwfn 作者 Sob 老师的 [《使用 Multiwfn 绘制红外、拉曼、UV-Vis、ECD、VCD 和 ROA 光谱图》](http://sobereva.com/224)。如果要使用 Multiwfn 绘制 NMR 谱，可以参考笔者的[《Gaussian + Multiwfn 绘制 NMR 谱》](https://ikuns.icu/013)或者 Sob 老师的原文[《使用 Multiwfn 绘制 NMR 谱》](http://sobereva.com/565)。

### 绘制单子图

KimariDraw 可以很方便的绘制单子图的光谱，包括单曲线图和多曲线图。假设我已经从 Multiwfn 生成了一个 `curve.txt` 文件，该文件中包含单子图的数据，则直接运行 `python kimaridraw.py curve.txt` 就可以在当前路径下生成绘制的光谱图。

<table>
  <td><img src="1.png"></td>
  <td><img src="2.png"></td>
</table>

### 绘制多子图

如果想要绘制多子图，首先必须将 toml 文件中的 `PlotType` 属性修改为 2，接着在当前文件夹下新建一个 `multiple.txt` 的文件。然后将需要绘制的子图的路径写在 txt 文件中，如下所示。

```txt
curve.txt
curve.txt
curve.txt
curve.txt
curve.txt
curve.txt
curve.txt
curve.txt
curve.txt
```

这个 `multiple.txt` 文件中内容所表示的意思是，绘制 9 个一模一样的子图，绘制的效果如下所示。

<img src="3.png">

## 后记

KimariDraw 还有很多功能，这里就不一一叙述了，有兴趣的可以前往 KimariDraw 的 [Github 主页](https://github.com/kimariyb/kimariDraw) 了解详情，感谢大家的支持！