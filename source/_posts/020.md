---
title: 如何使用量子化学程序计算共振式含量
date: 2023-09-04 12:19:40
tags:
    - NBO
    - NRT
    - 量子化学
    - 共振式
    - MarvinView
    - Multiwfn
    - Gaussian
categories: 
	- Computer Chemistry
description: 本文将介绍如何使用量子化学波函数分析程序 NBO 6 对一些常见化合物做自然共振理论（NRT, Natural resonance theory）分析，从而得到共振式含量。
---

## 前言

共振论（resonance theory）是由美国化学家鲍林所提出的一种分子结构理论，常用于讨论一些不能以单纯的化学键（即单、双以及三键）进行描述的分子结构，比如一些芳香烃。共振论中的结构（也就是共振结构）并不存在，真实粒子也并非这些共振结构的混合物或是平衡体系，只是价键理论中无法用单一结构式来准确表达物质结构，必须要借助共振论的思想。

***一个恰当的比喻：***

<img src="1.jpg" width="70%">

有关共振论的内容这里就不再过多介绍了。共振式是共振论中的一个概念，在学习化学的途中会经常看见有关共振式含量的问题，在最经典的共振论中（很多有机化学教科书上都有介绍，比如《基础有机化学》邢其毅，裴坚等），书写共振式时必须遵守以下两点：

- 所有的极限式必须符合路易斯结构式。
- 同一分子的极限式中原子排列顺序、总电子数和电荷数必须相同。

不同共振极限结构的稳定性可通过以下规则判断：

- 极限结构的电荷越分散越稳定；
- 满壳层的结构比价电子层不满的结构稳定；
- 负电荷处在电负性强原子上的极限结构更稳定，正电荷处在电负性弱原子上的极限结构更稳定；
- 具有不满壳层且带电荷原子的极限结构不稳定；
- 极限结构含有的共价键数目越多越稳定；
- 正负电荷分离越远越不稳定，同号电荷越近越不稳定；
- 键长、键角有改变的极限结构不稳定。

极限结构对杂化体的贡献中，越稳定的极限结构对杂化体贡献越大，因此真实分子的性质很大程度上依赖于贡献大的结构。

<img src="2.png" width="40%">

共振论在一些实验事实做出了很好的解释，但是在某些方面作出的预测甚至是错误的。我们从以上的介绍的内容就可以知道，共振论实际上并不是一个严格的科学理论，更应该称为类似 Huckle 规则一样的经验法则。从现在的视角看来，经典共振论并不科学，首先我们并不能通过其他方式衡量共振式的稳定性，只能通过这些经验规则定性判断。其次，这些经验规则也只是根据一些实验现象总结出来的规则，并不能提供定量判断的依据，也就是说没有数学上的表达式，至少在笔者看来，共振论就和 Huckle 规则一样已经不能满足当前科学发展的要求了。


## 自然共振理论

自然共振理论（NRT, Natural resonance theory）是通过量子化学计算手段计算得到体系各种可能的共振 Lewis 结构，并给出它们出现的比例（称为共振权重）。有关 NRT 的更多内容可参考 NRT 原文：***Journal of Computational Chemistry, Vol. 19, No. 6, 593-609, 1998***，NRT 的算法比较硬核，这里就不多赘述了。单独的 Gaussian 并不能做 NRT 分析，如果有人说用了 Gaussian 计算共振式的含量，我很好奇他是怎么做的，大概率是瞎算的。

目前比较流行的方法是使用 NBO 程序做 NRT 分析。其开发者 Weinhold 也提出了同名的 NBO (Nature Bond Orbital，自然键轨道) 理论。NBO 程序是一个全面实现 NBO 理论分析的波函数分析程序，可以和 Gaussian、Orca 等量子化学计算程序联用。NBO 理论定义了多种轨道，基于这些轨道可以考察类似于布局分析、轨道杂化分析、超共轭分析、自然共振分析、键级分析等等。

NBO 理论存在很多局限性，比如 NBO 理论很难讨论存在高度电子离域的体系。同时 NBO 理论把所有分子内、分子间的相互作用都称之为“超共轭”，但是绝大多数的弱相互作用都是色散作用和静电作用，因此 NBO 理论对弱相互作用的分析非常拉跨。NBO 理论还存在很多局限性，这里就不一一列举了，有关 NBO 的更多内容可以参考 [NBO 官网](https://nbo6.chem.wisc.edu/)

## 使用 NBO 程序

在使用 NBO 程序进行 NRT 分析之前，首先需要安装 NBO 程序，如何安装 NBO 程序请自行 Google，这里就不再赘述了。这里笔者使用的是 NBO 6 已经编译好的 Linux 版本（GENNBO 6）以及 Gaussian 16 A.03，笔者并不提供任何收费程序的安装包，请各凭本事获取。

**由于笔者使用的是 GENNBO 6 所以不能直接在 Gaussian 里调用 NBO 做 NRT 分析。笔者的解决方法是使用 Gaussian 生成 chk/fchk 文件后，再使用 Multiwfn 将 fchk 文件转为 NBO 的私有格式 `.47` 文件，最后调用 NBO 做 NRT 分析。下面是一个 `.47` 文件的例子。**

```shell
 $GENNBO NATOMS=5 NBAS=66 UPPER BODM $END
 $NBO NRTCML file=/home/kimariyb/nbo6/NRT $END
 $COORD
 Generated by Multiwfn
     7     7   -0.000000    0.153763    0.000000
     6     6   -0.001457   -1.138718   -0.000000
     1     1    0.951600   -1.643452   -0.000000
     1     1   -0.954910   -1.642283    0.000000
     7     7    0.001722    1.291672    0.000000
 $END
```

`$NBO NRTCML file=/home/kimariyb/nbo6/NRT $END` 中的 `NRTCML` 表示在做 NRT 分析之后，输出一个记载不同权重 Lewis 共振式的 cml 文件，`file` 表示输出文件的位置。如果只做 NRT 分析不输出文件，只需要将 `NRTCML` 修改为 `NRT` 然后把 `file` 删了就可以了。如果想在 Gaussian 做计算时同时调用 NBO 程序做 NRT 分析，则需要使用另外一个版本的 NBO 程序，也就是 ESS（electronic structure system）版本，这个版本可以直接通过在 gjf 文件里写上关键字运行 NBO 程序。

```gjf
# b3lyp/6-31g(d) pop=nbo6read

Test

0 1
 H                 -1.92214700   -0.35345600    0.00000000
 H                 -0.64384900   -1.53144400    0.00000000
 N                 -0.93826400   -0.56621500    0.00000000
 C                  0.00000000    0.41961100    0.00000000
 O                  1.19803500    0.23764800    0.00000000
 H                 -0.45043100    1.42955300    0.00000000

$NBO NRT $END
```

## 分析碳正离子共振

在经典的共振论中，下图的碳正离子一般被分解为下面两种共振极限式。很多有机化学教材都认为右边这种共振极限式是更加稳定的，对整个体系的贡献更多。理由是**满壳层的结构比价电子层不满的结构稳定**，下面我们使用量子化学的手段分析一下这个体系的共振式。


<img src="3.png" width="40%" >

这里对这个经典的碳正离子进行 NRT 分析，并得到不同权重下的 Lewis 共振式。如果使用的是 ESS 版本的 NBO 6，可以直接在 Gaussian 输入文件中写上关键词进行计算。这里为了省事，索性直接这样算了（如果使用的是 GENNBO 可以参考笔者上一节介绍的做法），输入文件（这个体系已经在 B3LYP/6-311G\* 的级别下优化好了）如下所示：

```gjf
%chk=CH32C+OCH3.chk
# b3lyp/6-311g(d) pop=nbo6read

Title Card Required

1 1
 C                  1.74959700   -0.72890000    0.00042200
 H                  1.61412800   -1.80589000    0.06787100
 H                  2.29947100   -0.47526500   -0.91520700
 H                  2.37184800   -0.36490500    0.82635200
 C                  0.46433900   -0.00602800   -0.00239400
 C                  0.40010700    1.47386800   -0.00389700
 H                  0.00561400    1.82143500    0.96056800
 H                  1.38409500    1.91454600   -0.14743600
 H                 -0.28493200    1.84545500   -0.77189500
 O                 -0.57520200   -0.73293300    0.00521500
 C                 -1.94916600   -0.19992600   -0.00196400
 H                 -2.13491300    0.26459100   -0.96859100
 H                 -2.57387300   -1.07518400    0.13557400
 H                 -2.06908600    0.50460200    0.81804000

$NBO NRTCML file=/home/kimariyb/nbo6/NRT $END
```

使用 Gaussian 执行这个文件，等待 Gaussian 算完后，就会在 `/home/kimariyb/nbo6/` 目录下生成一个 `NRT-nrt.cml` 文件，使用 [MarvinView](https://docs.chemaxon.com/display/docs/marvinview.md) 可视化程序打开这 cml 文件，就可以看见使用量子化学计算手段得到的不同权重下的 Lewis 共振式。

<img src="4.png">

在 MarvinView 中显示的结构不是很符合平常的化学直接，基础不太好的同学甚至不一定能看出这些结构到底是什么。所以笔者用 ChemDraw 把这些结构重新绘制了一遍，同时给出了各自的共振权重。有几个共振结构实际上是一种结构，之所以程序认为这几个结构存在差异，是因为程序没有考虑甲基可以转动。

<img src="5.png" width="75%">

根据 NRT 分析得到的结果，可以发现实际上这个所谓的“碳正离子”的结构有 80% 多是氧正离子贡献的。与其将其称之为碳正离子，还不如将其称之为氧正离子更加合理些。同时使用 NRT 分析得到的共振式和经典共振论的共振式存在很大的不同，尽管 NRT 分析得到的某些共振式结构很违反化学直觉，但是这是实打实的通过量子化学手段计算出来的结果，比经典共振论这种经验规则科学得多。

在进行 NRT 分析时，NBO 程序也会进行 NPA（Nature population analysis，自然布局分析），同时输出 NPA 电荷。NPA 电荷是一种原子电荷，这种电荷广泛应用于当今的化学科研当中。随便找一篇理论计算的文章都可能出现 NPA 分析以及 NPA 电荷。


```shell
 Summary of Natural Population Analysis:

                                     Natural Population
             Natural    ---------------------------------------------
  Atom No    Charge        Core      Valence    Rydberg      Total
 --------------------------------------------------------------------
    C  1   -0.65564      1.99915     4.64259    0.01389     6.65564
    H  2    0.25470      0.00000     0.74369    0.00161     0.74530
    H  3    0.27245      0.00000     0.72644    0.00111     0.72755
    H  4    0.26826      0.00000     0.73067    0.00107     0.73174
    C  5    0.72031      1.99922     3.25734    0.02313     5.27969
    C  6   -0.69134      1.99916     4.67928    0.01290     6.69134
    H  7    0.27622      0.00000     0.72274    0.00105     0.72378
    H  8    0.25580      0.00000     0.74330    0.00090     0.74420
    H  9    0.26451      0.00000     0.73453    0.00096     0.73549
    O 10   -0.40709      1.99958     6.39584    0.01167     8.40709
    C 11   -0.19466      1.99915     4.17958    0.01593     6.19466
    H 12    0.20777      0.00000     0.79108    0.00115     0.79223
    H 13    0.22654      0.00000     0.77283    0.00063     0.77346
    H 14    0.20216      0.00000     0.79662    0.00121     0.79784
 ====================================================================
 * Total *  1.00000      9.99625    29.91654    0.08721    40.00000
 ```

在下图中，笔者将该体系的 C 和 O 的 NPA 电荷标注出来了。可以看见尽管 NRT 分析得到的共振结构里氧正离子占主要的贡献，但是 C 的原子电荷仍有 0.720，这毫无疑问的是碳正离子最显著的特点了。和碳正相连的两个 C 的原子电荷之所以为 -0.6 多，是因为 C 把 H 上的电子都吸过来了，这些都非常好理解。

同时，从 NPA 电荷我们可以看出，不管是一个正离子、负离子还是一个中性体系，都不可能存在一个原子恰好带整数个电荷。也就是说，在有机化学书上常见的碳正离子、碳负离子等体系，无论存不存在共轭，这些正电荷或负电荷就不可能完完全全就分布在 C 上。这对于理解量子化学计算是非常重要的一点，这说明了量子化学计算没法指定某一个原子带什么电荷，只能通过计算的结果查看原子带什么电荷。

<img src="6.png" width="50%">


最后，无论是 NRT 理论还是经典的共振论，都存在局限性。与其在共振式上搞来搞去，还不如直接做几个布局分析和电荷分析省事得多。